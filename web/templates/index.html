<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-layout">
        <!-- Left Sidebar: Stats & Info -->
        <aside class="sidebar left-sidebar" style="animation-delay: 0.1s;">
            <div class="sidebar-header">
                <h3>üìä Quick Stats</h3>
            </div>
            <div class="stats-container">
                <div class="stat-item">
                    <span>This Month</span>
                    <strong id="month-spent-stat">0 ‚Ç´</strong>
                </div>
                <div class="stat-item">
                    <span>Total Revenue</span>
                    <strong id="total-income-stat" style="color: #10b981;">0 ‚Ç´</strong>
                </div>
                <div class="stat-item">
                    <span>Total Spending</span>
                    <strong id="total-expense-stat" style="color: #ef4444;">0 ‚Ç´</strong>
                </div>
                <div class="stat-item">
                    <span>Transactions</span>
                    <strong id="tx-count-stat">0</strong>
                </div>
            </div>
            <div class="quick-links" style="margin-top: 2rem;">
                <h3>üîó Quick Links</h3>
                <a href="/reports" class="sidebar-link">Monthly Reports</a>
                <a href="/export" class="sidebar-link">Export Data</a>
            </div>
        </aside>

        <!-- Center: Main Content -->
        <div class="container">
            <header style="position: relative;">
                <h1>Money Tracker</h1>
                <div style="position: absolute; top: 0; right: 0; display: flex; gap: 0.5rem;">
                    <button id="reset-bg-btn" title="Reset Background"
                        style="background: rgba(255,255,255,0.3); width: 40px; height: 40px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); color: #ef4444; border: none; cursor: pointer;">
                        ‚úï
                    </button>
                    <button id="bg-btn" title="Change Background"
                        style="background: rgba(255,255,255,0.3); width: 40px; height: 40px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); border: none; cursor: pointer;">
                        üé®
                    </button>
                    <input type="file" id="bg-input" accept="image/*" hidden>
                </div>
                <div class="balance-card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h2 style="margin: 0; font-size: 1.1rem; opacity: 0.9;">Monthly Balance</h2>
                        <select id="month-selector" class="month-selector">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="amount" id="balance-amount">{{ "{:,.0f}".format(balance) }} ‚Ç´</div>
                </div>
            </header>

            <main>
                <!-- Chart Section -->
                <section class="chart-section"
                    style="background: white; padding: 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); animation-delay: 0.2s;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">Expense Breakdown</h3>
                        <a href="/reports"
                            style="text-decoration: none; background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500;">üìä
                            Monthly Reports</a>
                    </div>
                    <div class="chart-container" style="position: relative; height:300px; width:100%">
                        <canvas id="expenseChart"></canvas>
                    </div>
                </section>

                <!-- Budget Manager Section -->
                <section class="budget-manager"
                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); animation-delay: 0.3s;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">üí∞ Budget Manager</h3>
                    </div>
                    <p style="margin-bottom: 1rem; opacity: 0.9;">Set monthly spending limits for each category</p>

                    <!-- Budget Form - Dynamic Grid Style -->
                    <div class="budget-form-wrapper"
                        style="background: rgba(255,255,255,0.15); padding: 0.75rem; border-radius: 1rem; margin-bottom: 1.5rem; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2);">
                        <div class="budget-input-group"
                            style="display: grid; grid-template-columns: 140px 1fr auto; gap: 0.5rem; align-items: stretch; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
                            <select id="budget-category" class="budget-select"
                                style="padding: 0.8rem; border-radius: 0.75rem; border: none; outline: none; font-size: 0.95rem; color: #1f2937; background: white; transition: all 0.4s ease; cursor: pointer; width: 100%;">
                                <option value="">Category</option>
                                <option value="Food">üçî Food & Drink</option>
                                <option value="Rent">üè† Rent / Housing</option>
                                <option value="Utilities">üí° Utilities</option>
                                <option value="Transport">üöó Transportation</option>
                                <option value="Groceries">üõí Groceries</option>
                                <option value="Shopping">üõçÔ∏è Shopping</option>
                                <option value="Entertainment">üéÆ Entertainment</option>
                                <option value="Travel">‚úàÔ∏è Travel</option>
                                <option value="Health">üí™ Health & Fitness</option>
                                <option value="Other">üì¶ Other</option>
                            </select>
                            <input type="text" id="budget-limit" class="budget-input"
                                placeholder="Limit (e.g. 20k or 350)" autocomplete="off"
                                style="padding: 0.8rem; border-radius: 0.75rem; border: none; outline: none; font-size: 1rem; color: #1f2937; background: white; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); width: 100%;">
                            <button id="set-budget-btn" class="budget-btn"
                                style="background: white; color: #10b981; border: none; padding: 0 1.5rem; border-radius: 0.75rem; font-weight: 700; cursor: pointer; font-size: 1rem; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; justify-content: center; white-space: nowrap; height: 100%;">
                                <span class="btn-text">Set Budget</span>
                                <span class="btn-icon">üí∞</span>
                            </button>
                        </div>
                    </div>

                    <style>
                        /* Dynamic Budget Form Animations */
                        .budget-input-group:focus-within {
                            /* Sliding effect: shrink category, expand input, shrink button */
                            grid-template-columns: 100px 1.5fr 60px;
                        }

                        .budget-input-group:focus-within .budget-select {
                            font-size: 0.85rem;
                            opacity: 0.8;
                        }

                        .budget-input-group:focus-within .budget-input {
                            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3);
                            font-size: 1.1rem;
                        }

                        .budget-input-group:focus-within .budget-btn {
                            padding: 0;
                            border-radius: 12px;
                            width: 50px;
                            height: 50px;
                            margin-left: auto;
                            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
                            animation: pulse-green 2s infinite;
                        }

                        @keyframes pulse-green {
                            0% {
                                transform: scale(1);
                            }

                            50% {
                                transform: scale(1.05);
                            }

                            100% {
                                transform: scale(1);
                            }
                        }

                        /* State Management for Button Content */
                        .budget-btn .btn-icon {
                            display: none;
                            font-size: 1.5rem;
                        }

                        .budget-input-group:focus-within .budget-btn .btn-text {
                            display: none;
                        }

                        .budget-input-group:focus-within .budget-btn .btn-icon {
                            display: block;
                        }

                        /* Interactive hover to reveal detail even when focused */
                        .budget-btn:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            background: #f0fdf4;
                        }

                        .budget-input-group:focus-within .budget-btn:hover {
                            width: 140px;
                            padding: 0 1.2rem;
                            border-radius: 0.75rem;
                            margin-left: 0;
                        }

                        .budget-input-group:focus-within .budget-btn:hover .btn-text {
                            display: block;
                        }

                        .budget-input-group:focus-within .budget-btn:hover .btn-icon {
                            display: none;
                        }
                    </style>

                    <!-- Budget Status List -->
                    <div id="budget-list" style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <!-- Budget items will be inserted here -->
                    </div>
                </section>

                <!-- Assets Overview Section -->
                <section class="assets-overview"
                    style="background: linear-gradient(135deg, #0e7490 0%, #0891b2 100%); padding: 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); animation-delay: 0.4s;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">üóÉÔ∏è My Assets & Savings</h3>
                    </div>

                    <div id="assets-loading" style="text-align: center; opacity: 0.8; font-size: 0.9rem;">
                        Loading assets...
                    </div>

                    <div id="assets-content" style="display: none;">
                        <!-- Liquid Assets -->
                        <div style="margin-bottom: 1.5rem;">
                            <h4
                                style="margin: 0 0 0.5rem 0; font-size: 0.9rem; text-transform: uppercase; opacity: 0.9; letter-spacing: 0.05em;">
                                Liquid Assets</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                <div
                                    style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 0.75rem; border: 1px solid rgba(255,255,255,0.2);">
                                    <div style="font-size: 0.8rem; opacity: 0.8;">Cash</div>
                                    <div style="font-size: 1.25rem; font-weight: 700;" id="asset-cash">0 ‚Ç´</div>
                                </div>
                                <div
                                    style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 0.75rem; border: 1px solid rgba(255,255,255,0.2);">
                                    <div style="font-size: 0.8rem; opacity: 0.8;">Bank</div>
                                    <div style="font-size: 1.25rem; font-weight: 700;" id="asset-bank">0 ‚Ç´</div>
                                </div>
                            </div>
                        </div>

                        <!-- Savings -->
                        <div>
                            <h4
                                style="margin: 0 0 0.5rem 0; font-size: 0.9rem; text-transform: uppercase; opacity: 0.9; letter-spacing: 0.05em;">
                                Savings</h4>
                            <div id="savings-list" style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <!-- Savings items will be injected here -->
                            </div>
                        </div>
                    </div>
                </section>

                <section class="ai-assistant"
                    style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); padding: 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); animation-delay: 0.5s;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">‚ú® Magic Assistant</h3>
                        <div style="display: flex; align-items: center; gap: 0.8rem;">
                            <button id="bulk-ai-btn" title="Bulk Import from Text"
                                style="background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.75rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                                üìã Bulk Scan
                            </button>
                            <div style="display: flex; align-items: center; gap: 0.3rem; margin-left: 0.5rem;">
                                <select id="model-selector"
                                    style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 0.5rem; padding: 0.2rem 0.4rem; font-size: 0.75rem; outline: none; cursor: pointer;">
                                    <option value="openai" style="color: black;">OpenAI</option>
                                    <option value="gemini" style="color: black;">Gemini</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <p style="margin-bottom: 1rem; opacity: 0.9;">"Spent 50k on coffee", "Salary 20m", or "Set food
                        budget
                        to 5m"</p>
                    <div class="ai-container" style="display: flex; gap: 0.5rem; align-items: stretch;">
                        <input type="text" id="ai-input" placeholder="Type here (e.g. 'Coffee 30k')..."
                            autocomplete="off">
                        <button id="ai-btn">
                            <span class="btn-text">Ask AI</span>
                            <span class="btn-icon">‚ú®</span>
                        </button>
                        <div id="ai-loading">
                            <span style="animation: spin 1s linear infinite; font-size: 1.5rem;">‚è≥</span>
                        </div>
                    </div>
                    <style>
                        /* Specific Styles for AI Section to override globals */
                        .ai-container input {
                            flex: 1;
                            /* Take available space */
                            min-width: 0;
                            /* Allow shrinking below content size if needed */
                            padding: 1rem;
                            border-radius: 0.75rem;
                            border: 2px solid rgba(255, 255, 255, 0.3);
                            outline: none;
                            font-size: 1.1rem;
                            color: #1f2937 !important;
                            /* Force dark text */
                            background: white !important;
                            caret-color: #6366f1;
                            transition: all 0.3s ease;
                        }

                        .ai-container input::placeholder {
                            color: #9ca3af;
                        }

                        .ai-container input:focus {
                            border-color: white;
                            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
                        }

                        .ai-container button {
                            width: auto !important;
                            /* CRITICAL: Override global 100% width */
                            background: white;
                            color: #6366f1;
                            border: none;
                            padding: 0 1.5rem;
                            border-radius: 0.75rem;
                            font-weight: 700;
                            cursor: pointer;
                            font-size: 1.1rem;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            white-space: nowrap;
                            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                            overflow: hidden;
                        }

                        .ai-container .btn-icon {
                            display: none;
                        }

                        /* Interaction Logic: 
                       When Input is Focused (Typing) -> Button shrinks to Icon
                       However, user also said "Hover mouse cursor over it -> Enlarge"
                    */

                        /* State: Typing (Input Focus) -> Shrink Button */
                        .ai-container:focus-within button {
                            padding: 0 1rem;
                            max-width: 50px;
                            /* Shrink to icon size */
                        }

                        .ai-container:focus-within button .btn-text {
                            display: none;
                        }

                        .ai-container:focus-within button .btn-icon {
                            display: inline-block;
                        }

                        /* State: Hovering Button (Even while typing) -> Expand Button */
                        .ai-container button:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
                            padding: 0 1.5rem;
                            max-width: 200px;
                            /* Expand back */
                        }

                        .ai-container button:hover .btn-text {
                            display: inline-block;
                        }

                        .ai-container button:hover .btn-icon {
                            display: none;
                        }

                        #ai-loading {
                            display: none;
                            align-items: center;
                            justify-content: center;
                            background: rgba(255, 255, 255, 0.2);
                            padding: 0 1.5rem;
                            border-radius: 0.75rem;
                        }

                        @keyframes spin {
                            from {
                                transform: rotate(0deg);
                            }

                            to {
                                transform: rotate(360deg);
                            }
                        }
                    </style>
                </section>


                <section class="add-transaction">
                    <h3>Add Transaction</h3>
                    <form id="transaction-form">
                        <div class="form-group">
                            <label for="amount">Amount (in thousand ‚Ç´)</label>
                            <input type="text" id="amount" required placeholder="e.g. 100 (= 100.000 ‚Ç´)"
                                autocomplete="off">
                        </div>

                        <div class="form-group">
                            <label for="category">Category</label>
                            <select id="category" required>
                                <option value="" disabled selected>Select category</option>
                                <optgroup label="Essential Expenses">
                                    <option value="Food">Food & Drink</option>
                                    <option value="Rent">Rent / Housing</option>
                                    <option value="Utilities">Utilities (Electricity/Water)</option>
                                    <option value="Transport">Transportation</option>
                                    <option value="Groceries">Groceries</option>
                                </optgroup>
                                <optgroup label="Lifestyle">
                                    <option value="Shopping">Shopping</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="Travel">Travel</option>
                                    <option value="Health">Health & Fitness</option>
                                </optgroup>
                                <optgroup label="Income">
                                    <option value="Salary">Salary</option>
                                    <option value="Bonus">Bonus</option>
                                    <option value="Investment">Investment</option>
                                    <option value="Other Income">Other Income</option>
                                </optgroup>
                                <option value="Other">Other Expense</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="type">Type</label>
                            <select id="type">
                                <option value="expense">Expense</option>
                                <option value="income">Income</option>
                            </select>
                        </div>
                        <div class="form-group" id="payment-source-group">
                            <label for="transaction-asset">Payment Source (Optional)</label>
                            <select id="transaction-asset">
                                <option value="">None (Just track)</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="description">Description (Optional)</label>
                            <input type="text" id="description" placeholder="Short description">
                        </div>
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="datetime-local" id="date">
                        </div>
                        <button type="submit">Add Transaction</button>
                    </form>
                </section>

                <section class="recent-transactions">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin-bottom: 0;">Recent Transactions</h3>
                        <a href="/export" class="export-btn"
                            style="text-decoration: none; background-color: #10b981; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500;">Export
                            to Excel</a>
                    </div>
                    <ul id="transaction-list">
                        {% for transaction in transactions %}
                        <li class="transaction-item {{ transaction.type }}">
                            <div class="info">
                                <span class="category">{{ transaction.category }}</span>
                                <span class="date">{{ transaction.date }}</span>
                            </div>
                            <div class="amount">
                                {{ "-" if transaction.type == "expense" else "+" }}{{
                                "{:,.0f}".format(transaction.amount)
                                }} ‚Ç´
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </section>
            </main>
        </div>

        <!-- Right Sidebar: Daily Journal -->
        <aside class="sidebar right-sidebar" style="animation-delay: 0.6s;">
            <div class="sidebar-header">
                <h3>üìù Daily Journal</h3>
                <input type="date" id="diary-date"
                    style="padding: 0.3rem; font-size: 0.8rem; border-radius: 0.4rem; border: 1px solid #ddd; margin-top: 0.5rem; width: 100%;">
            </div>
            <div class="diary-container">
                <input type="text" id="diary-title" placeholder="Note Title (Optional)"
                    style="width: 100%; padding: 0.8rem; border-radius: 0.6rem; border: 1px solid #e5e7eb; font-family: inherit; font-size: 0.9rem; margin-bottom: 0.5rem; background: rgba(255,255,255,0.7); font-weight: 600;">
                <div class="diary-toolbar">
                    <button type="button" onclick="formatDoc('bold')" title="Bold"><b>B</b></button>
                    <button type="button" onclick="formatDoc('italic')" title="Italic"><i>I</i></button>
                    <button type="button" onclick="formatDoc('underline')" title="Underline"><u>U</u></button>
                    <button type="button" onclick="formatDoc('strikeThrough')" title="Strikethrough"><s>S</s></button>
                    <input type="color" onchange="formatDoc('foreColor', this.value)" title="Text Color">
                </div>
                <div id="diary-content" class="rich-editor" contenteditable="true"
                    data-placeholder="Share your thoughts for today..."></div>
                <button id="save-diary-btn"
                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-bottom: 1.5rem;">Save
                    Note</button>

                <div class="diary-history" style="border-top: 1px solid #eee; padding-top: 1.5rem;">
                    <h4
                        style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 0.4rem;">
                        üìÖ Recent Notes
                    </h4>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <input type="text" id="note-search" placeholder="Search notes (e.g. 2026-01)..."
                            style="width: 100%; padding: 0.5rem; font-size: 0.8rem; border-radius: 0.4rem; border: 1px solid #e5e7eb; margin-bottom: 0.5rem; background: rgba(255,255,255,0.8);">
                        <div id="diary-history-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <!-- History items will be injected here -->
                            <p style="font-size: 0.75rem; color: #9ca3af; text-align: center;">No notes recorded yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>Edit Transaction</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <div class="form-group">
                    <label for="edit-amount">Amount (in thousand ‚Ç´)</label>
                    <input type="text" id="edit-amount" required placeholder="0" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="edit-category">Category</label>
                    <select id="edit-category" required>
                        <option value="" disabled selected>Select category</option>
                        <optgroup label="Essential Expenses">
                            <option value="Food">Food & Drink</option>
                            <option value="Rent">Rent / Housing</option>
                            <option value="Utilities">Utilities (Electricity/Water)</option>
                            <option value="Transport">Transportation</option>
                            <option value="Groceries">Groceries</option>
                        </optgroup>
                        <optgroup label="Lifestyle">
                            <option value="Shopping">Shopping</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Travel">Travel</option>
                            <option value="Health">Health & Fitness</option>
                        </optgroup>
                        <optgroup label="Income">
                            <option value="Salary">Salary</option>
                            <option value="Bonus">Bonus</option>
                            <option value="Investment">Investment</option>
                            <option value="Other Income">Other Income</option>
                        </optgroup>
                        <option value="Other">Other Expense</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-type">Type</label>
                    <select id="edit-type">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-description">Description</label>
                    <input type="text" id="edit-description">
                </div>
                <div class="form-group">
                    <label for="edit-date">Date</label>
                    <input type="datetime-local" id="edit-date" required>
                </div>
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>
    <!-- Bulk Import Modal -->
    <div id="bulk-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close-btn" onclick="closeBulkModal()">&times;</span>
            <h3 style="display: flex; align-items: center; gap: 0.5rem;">‚ú® AI Bulk Transaction Extraction</h3>

            <div id="bulk-input-step">
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 1rem;">
                    Paste your diary, notes, or chat history below. AI will automatically find all transactions and
                    dates.
                </p>
                <textarea id="bulk-text-input" placeholder="Example:
12/1/2025: Spent 50k on lunch. 
15/1/2025: Received salary 20m..."
                    style="width: 100%; height: 300px; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 0.75rem; font-family: 'Inter', sans-serif; font-size: 0.95rem; margin-bottom: 1rem; outline: none; transition: border-color 0.2s;"></textarea>
                <button id="bulk-extract-btn"
                    style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); font-weight: 700;">
                    Scan Text with AI ‚ú®
                </button>
            </div>

            <div id="bulk-review-step" style="display: none;">
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 1rem;">
                    Review the detected transactions. Uncheck any you don't want to import.
                </p>
                <div
                    style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                        <thead style="background: #f8fafc; position: sticky; top: 0; z-index: 1;">
                            <tr>
                                <th style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0; text-align: left;"><input
                                        type="checkbox" id="bulk-select-all" checked></th>
                                <th style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0; text-align: left;">Date
                                </th>
                                <th style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0; text-align: left;">
                                    Description</th>
                                <th style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0; text-align: left;">
                                    Category</th>
                                <th style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0; text-align: right;">
                                    Amount</th>
                            </tr>
                        </thead>
                        <tbody id="bulk-review-table-body">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button onclick="backToBulkInput()"
                        style="background: #f1f5f9; color: #475569; font-weight: 600;">Back</button>
                    <button id="bulk-confirm-btn" style="background: #10b981; font-weight: 700;">Import <span
                            id="bulk-count-badge">0</span> Transactions</button>
                </div>
            </div>

            <div id="bulk-loading" style="display: none; text-align: center; padding: 3rem 0;">
                <div style="animation: spin 1s linear infinite; font-size: 3rem; margin-bottom: 1rem;">‚è≥</div>
                <p style="font-weight: 600; color: var(--primary);">AI is analyzing your notes...</p>
                <p style="font-size: 0.8rem; color: #94a3b8;">This may take 10-20 seconds for long texts.</p>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>